<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendário Interativo - Protege Vacinas</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f8fa;
    margin: 0; padding: 0;
    display: flex;
    min-height: 100vh;
    justify-content: center;
    align-items: flex-start;
    padding-top: 20px;
    padding-top: 80px;
    color: #222;
  }

  /* Topbar */
.topbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  height: 60px;
  background-color: #0047b3;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 24px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.15);
  z-index: 1000;
}

.topbar .logo img {
  height: 40px;
}

.topbar .profile {
  display: flex;
  align-items: center;
  gap: 12px;
  color: white;
  cursor: pointer;
}

.topbar .profile .avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid white;
  transition: transform 0.2s;
}

.topbar .profile:hover .avatar,
.topbar .profile:focus .avatar {
  transform: scale(1.1);
}

.topbar .username {
  font-weight: 600;
  font-size: 1rem;
  text-transform: lowercase;
}


  /* Container do dashboard */
  .dashboard {
    max-width: 1000px;
    width: 100%;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  /* Botões laterais */
  .sidebar {
    flex: 1 1 200px;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .btn-sidebar {
    background-color: #0047b3;
    border-radius: 8px;
    padding: 16px;
    color: white;
    font-size: 1.25rem;
    font-weight: 600;
    text-transform: lowercase;
    cursor: pointer;
    border: none;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background-color 0.3s;
  }
  .btn-sidebar:hover {
    background-color: #00337a;
  }
  .btn-sidebar svg {
    width: 28px;
    height: 28px;
    stroke: white;
    stroke-width: 2;
  }

  /* Notas */
  .notes {
    flex: 0 1 140px;
    border: 1px solid #0047b3;
    border-radius: 8px;
    padding: 16px;
    font-size: 1rem;
    line-height: 1.5;
    user-select: none;
  }
  .notes-title {
    font-weight: 700;
    margin-bottom: 12px;
    text-transform: lowercase;
  }

  /* Calendário */
  .calendar-container {
    flex: 2 1 600px;
    border: 3px solid #0047b3;
    border-radius: 0 20px 20px 0;
    padding: 24px 32px;
    background: white;
    box-shadow: 0 5px 15px rgba(0, 71, 179, 0.15);
    position: relative;
    overflow-x: auto;
  }

  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .calendar-title {
    font-weight: 700;
    font-size: 1.5rem;
    color: #0047b3;
    text-transform: lowercase;
  }

  .nav-buttons {
    display: flex;
    gap: 12px;
  }
  .nav-btn {
    background-color: #0047b3;
    border: none;
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 1.25rem;
    font-weight: 700;
    user-select: none;
    transition: background-color 0.3s;
  }
  .nav-btn:hover {
    background-color: #00275c;
  }

  table.calendar {
    border-collapse: collapse;
    width: 100%;
    table-layout: fixed;
    font-family: monospace;
    font-size: 0.85rem;
    text-align: center;
  }
  table.calendar th,
  table.calendar td {
    border: 1px solid #b5c3e2;
    padding: 8px 6px;
    vertical-align: top;
    position: relative;
    cursor: pointer;
    user-select: none;
  }

  table.calendar th {
    color: #0047b3;
    text-transform: uppercase;
  }

  table.calendar td:hover:not(.disabled) {
    background-color: #e0ebff;
  }

  table.calendar td.disabled {
    color: #ccc;
    background: #f9f9f9;
    cursor: default;
  }

  table.calendar td.today {
    background-color: #0047b3;
    color: white;
    font-weight: 700;
    border-radius: 4px;
  }

  /* Evento dentro do dia */
  .event {
    display: block;
    margin-top: 4px;
    background: #0047b3;
    color: white;
    font-size: 0.75rem;
    padding: 2px 6px;
    border-radius: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .event:hover {
    background-color: #00275c;
  }

  /* Tooltip */
  .tooltip {
    position: absolute;
    background: #0047b3;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 0.85rem;
    white-space: pre-line;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.25s;
    z-index: 9999;
  }
  .tooltip.show {
    opacity: 1;
  }

  /* Modal (fundo escurecido) */
  .modal-bg {
    position: fixed;
    top: 0; left: 0; right:0; bottom:0;
    background: rgba(0,0,0,0.6);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 10000;
  }
  .modal-bg.show {
    display: flex;
  }
  /* Modal */
  .modal {
    background: white;
    padding: 24px 30px;
    border-radius: 14px;
    width: 320px;
    max-width: 90vw;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    position: relative;
    animation: fadeInScale 0.3s ease forwards;
  }
  @keyframes fadeInScale {
    from {
      opacity: 0; transform: scale(0.7);
    } to {
      opacity: 1; transform: scale(1);
    }
  }
  .modal h2 {
    margin-top: 0;
    margin-bottom: 16px;
    color: #0047b3;
    text-transform: lowercase;
    font-weight: 700;
  }
  .modal textarea {
    width: 100%;
    height: 80px;
    padding: 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #aaa;
    resize: vertical;
    font-family: inherit;
  }
  .modal textarea:focus {
    outline: none;
    border-color: #0047b3;
    box-shadow: 0 0 8px rgba(0, 71, 179, 0.5);
  }
  .modal-buttons {
    margin-top: 14px;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
  }
  .btn {
    cursor: pointer;
    padding: 8px 16px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 1rem;
    border: none;
    transition: background-color 0.3s;
  }
  .btn-save {
    background-color: #0047b3;
    color: white;
  }
  .btn-save:hover {
    background-color: #00275c;
  }
  .btn-cancel {
    background-color: #ccc;
  }
  .btn-cancel:hover {
    background-color: #999;
  }

  /* Responsividade */
  @media (max-width: 850px) {
    .dashboard {
      flex-direction: column;
      align-items: center;
    }
    .sidebar,
    .notes,
    .calendar-container {
      flex: none;
      width: 100%;
      max-width: 100%;
    }
  }
</style>
</head>
<body>
<header class="topbar">
  <div class="logo">
    <img src="/imgs/logo.jpeg" alt="Protege Vacinas" />
  </div>
  <div class="profile" tabindex="0" aria-label="Perfil do usuário">
    <img src="user-avatar.png" alt="Avatar" class="avatar" />
    <span class="username">Usuário</span>
  </div>
</header>
<div class="dashboard">

  <!-- Botões laterais -->
  <div class="sidebar" role="navigation" aria-label="Menu principal">
    <button class="btn-sidebar" type="button" aria-label="Unidades">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 4-7 13-7 13S5 13 5 9a7 7 0 0 1 7-7z" /><circle cx="12" cy="9" r="2" /></svg>
      unidades
    </button>
    <button class="btn-sidebar" type="button" aria-label="Agendamento">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /><line x1="12" y1="14" x2="12" y2="18" /><line x1="9" y1="17" x2="15" y2="17" /></svg>
      agendamento
    </button>
    <button class="btn-sidebar" type="button" aria-label="Suporte">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /><path d="M8 10h.01M12 10h.01M16 10h.01M9 16h6" /></svg>
      suporte
    </button>
  </div>

  <!-- Notas -->
  <div class="notes" aria-label="Notas importantes">
    <div class="notes-title">notas</div>
    <div>9/4 vacina em posto de igarassu</div>
    <div>25/2 chegada de remedios</div>
  </div>

  <!-- Calendário -->
  <section class="calendar-container" aria-label="Calendário de vacinação">
    <div class="calendar-header">
      <h3 class="calendar-title" id="monthYear"></h3>
      <div class="nav-buttons" role="group" aria-label="Navegação entre meses">
        <button class="nav-btn" id="prevMonth" aria-label="Mês anterior">&lt;</button>
        <button class="nav-btn" id="nextMonth" aria-label="Próximo mês">&gt;</button>
      </div>
    </div>
    <table class="calendar" role="grid" aria-labelledby="monthYear">
      <thead>
        <tr>
          <th scope="col">seg</th>
          <th scope="col">ter</th>
          <th scope="col">qua</th>
          <th scope="col">qui</th>
          <th scope="col">sex</th>
          <th scope="col">sab</th>
          <th scope="col">dom</th>
        </tr>
      </thead>
      <tbody id="calendarBody">
        <!-- Dias vão ser inseridos aqui -->
      </tbody>
    </table>
    <button id="clearEventsBtn" class="btn btn-cancel" style="margin-top:16px;">Limpar eventos</button>
  </section>
</div>

<!-- Modal -->
<div class="modal-bg" id="modalBg" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-describedby="modalDesc">
  <div class="modal" role="document">
    <h2 id="modalTitle">Adicionar evento</h2>
    <textarea id="eventText" placeholder="Digite o evento aqui..."></textarea>
    <div class="modal-buttons">
      <button class="btn btn-cancel" id="cancelBtn">Cancelar</button>
      <button class="btn btn-save" id="saveBtn">Salvar</button>
    </div>
  </div>
</div>

<!-- Tooltip -->
<div class="tooltip" id="tooltip"></div>

<script>
(() => {
  const calendarBody = document.getElementById('calendarBody');
  const monthYear = document.getElementById('monthYear');
  const prevMonthBtn = document.getElementById('prevMonth');
  const nextMonthBtn = document.getElementById('nextMonth');
  const modalBg = document.getElementById('modalBg');
  const eventText = document.getElementById('eventText');
  const cancelBtn = document.getElementById('cancelBtn');
  const saveBtn = document.getElementById('saveBtn');
  const tooltip = document.getElementById('tooltip');
  const clearEventsBtn = document.getElementById('clearEventsBtn');

  let currentDate = new Date();
  let currentMonth = currentDate.getMonth();
  let currentYear = currentDate.getFullYear();

  // Eventos salvos { 'YYYY-MM-DD': ['evento1', 'evento2'] }
  let events = JSON.parse(localStorage.getItem('pv_events')) || {};

  let selectedDateStr = null;

  // Atualiza título mês e ano
  function updateMonthYear() {
    const months = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
    monthYear.textContent = `${months[currentMonth]} ${currentYear}`;
  }

  // Formata número com zero à esquerda
  function pad(n) {
    return n < 10 ? '0' + n : n;
  }

  // Gera calendário
  function generateCalendar(month, year) {
    calendarBody.innerHTML = '';

    // Primeiro dia do mês
    const firstDay = new Date(year, month, 1);
    // Último dia do mês
    const lastDay = new Date(year, month + 1, 0);
    // Dia da semana do primeiro dia (seg=1..dom=7)
    // Em JS, domingo=0..sábado=6
    let startDay = firstDay.getDay(); // domingo=0
    // Ajusta para segunda-feira início
    startDay = startDay === 0 ? 7 : startDay;

    // Quantidade de dias no mês
    const daysInMonth = lastDay.getDate();

    // Calcula quantos dias da semana anterior vão aparecer
    // Para preencher a semana começando na seg.
    // Exemplo: se começa na quarta (4), aparecem 3 dias antes
    let prevDays = startDay - 1;

    // Último dia do mês anterior
    const lastDayPrevMonth = new Date(year, month, 0).getDate();

    // Total linhas - geralmente 5 a 6 semanas
    const totalCells = 42;

    // Preenche as células
    let dayNum = 1;
    let nextMonthDay = 1;

    for (let i = 1; i <= totalCells; i++) {
      const tr = i % 7 === 1 ? document.createElement('tr') : calendarBody.lastElementChild;

      if (!calendarBody.lastElementChild || i % 7 === 1) {
        calendarBody.appendChild(tr);
      }

      let td = document.createElement('td');

      if (i <= prevDays) {
        // Dias do mês anterior (desativados)
        td.textContent = lastDayPrevMonth - prevDays + i;
        td.classList.add('disabled');
      } else if (dayNum <= daysInMonth) {
        // Dias do mês atual
        td.textContent = dayNum;

        // Identificador da data para eventos YYYY-MM-DD
        const dateStr = `${year}-${pad(month+1)}-${pad(dayNum)}`;
        td.dataset.date = dateStr;
        td.setAttribute('tabindex', '0');
        td.setAttribute('role', 'gridcell');
        td.setAttribute('aria-label', `Dia ${dayNum} de ${monthYear.textContent}`);

        // Destacar dia atual
        const today = new Date();
        if (dayNum === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
          td.classList.add('today');
        }

        // Eventos do dia
        if(events[dateStr]) {
          events[dateStr].forEach((evText, idx) => {
            const span = document.createElement('span');
            span.className = 'event';
            span.textContent = evText.length > 12 ? evText.slice(0,12) + '...' : evText;
            span.title = evText; // tooltip nativo para acessibilidade
            span.dataset.date = dateStr;
            span.dataset.idx = idx;
            td.appendChild(span);
          });
        }

        // Clique para adicionar evento
        td.addEventListener('click', () => {
          selectedDateStr = dateStr;
          eventText.value = '';
          openModal();
        });

        // Teclado Enter para adicionar evento
        td.addEventListener('keydown', e => {
          if(e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectedDateStr = dateStr;
            eventText.value = '';
            openModal();
          }
        });

      } else {
        // Dias do mês seguinte (desativados)
        td.textContent = nextMonthDay++;
        td.classList.add('disabled');
      }

      tr.appendChild(td);
    }
  }

  function openModal() {
    modalBg.classList.add('show');
    eventText.focus();
  }

  function closeModal() {
    modalBg.classList.remove('show');
    selectedDateStr = null;
    eventText.value = '';
  }

  // Salva evento
  function saveEvent() {
    const text = eventText.value.trim();
    if(text && selectedDateStr) {
      if(!events[selectedDateStr]) {
        events[selectedDateStr] = [];
      }
      events[selectedDateStr].push(text);
      localStorage.setItem('pv_events', JSON.stringify(events));
      generateCalendar(currentMonth, currentYear);
      closeModal();
    } else {
      alert('Por favor, digite um evento antes de salvar.');
      eventText.focus();
    }
  }

  // Tooltip para eventos
  let tooltipTimeout;
  document.body.addEventListener('mouseover', e => {
    if(e.target.classList.contains('event')) {
      clearTimeout(tooltipTimeout);
      tooltip.textContent = e.target.title || '';
      const rect = e.target.getBoundingClientRect();
      tooltip.style.top = (rect.top - 40) + 'px';
      tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
      tooltip.classList.add('show');
    }
  });
  document.body.addEventListener('mouseout', e => {
    if(e.target.classList.contains('event')) {
      tooltipTimeout = setTimeout(() => tooltip.classList.remove('show'), 200);
    }
  });

  // Navegação meses
  prevMonthBtn.addEventListener('click', () => {
    if(currentMonth === 0) {
      currentMonth = 11;
      currentYear--;
    } else {
      currentMonth--;
    }
    updateMonthYear();
    generateCalendar(currentMonth, currentYear);
  });
  nextMonthBtn.addEventListener('click', () => {
    if(currentMonth === 11) {
      currentMonth = 0;
      currentYear++;
    } else {
      currentMonth++;
    }
    updateMonthYear();
    generateCalendar(currentMonth, currentYear);
  });

  // Botões do modal
  cancelBtn.addEventListener('click', closeModal);
  saveBtn.addEventListener('click', saveEvent);
  modalBg.addEventListener('click', e => {
    if(e.target === modalBg) closeModal();
  });

  // Limpar eventos
  clearEventsBtn.addEventListener('click', () => {
    if(confirm('Deseja realmente apagar todos os eventos salvos?')) {
      events = {};
      localStorage.removeItem('pv_events');
      generateCalendar(currentMonth, currentYear);
    }
  });

  // Inicialização
  updateMonthYear();
  generateCalendar(currentMonth, currentYear);

})();
</script>

</body>
</html>
